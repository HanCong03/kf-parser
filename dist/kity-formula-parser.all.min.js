/*!
 * ====================================================
 * Kity Formula Parser - v1.0.0 - 2015-06-10
 * https://github.com/HanCong03/kityformula-editor
 * GitHub: https://github.com/kitygraph/kityformula-editor.git 
 * Copyright (c) 2015 Baidu Kity Group; Licensed MIT
 * ====================================================
 */
!function(){function a(a){b.r([c[a]])}var b={r:function(a){if(b[a].inited)return b[a].value;if("function"!=typeof b[a].value)return b[a].inited=!0,b[a].value;var c={exports:{}},d=b[a].value(null,c.exports,c);if(b[a].inited=!0,b[a].value=d,void 0!==d)return d;for(var e in c.exports)if(c.exports.hasOwnProperty(e))return b[a].inited=!0,b[a].value=c.exports,c.exports}};b[0]={value:function(){function a(a){this.formula=a}function b(a,e,f,g,i){var j,k=null,l=null,m=[],n=e.operand||[],o=null;if(f.operand=[],e.name&&-1===e.name.indexOf("text")){for(var p=0,q=n.length;q>p;p++)k=n[p],k!==h?k?"string"==typeof k?(n[p]="brackets"===e.name&&2>p?k:"function"===e.name&&0===p?k:c("text",k),f.operand.push(n[p])):(f.operand.push({}),n[p]=b(a.operand[p],k,f.operand[f.operand.length-1],g,i)):(n[p]=c("empty"),f.operand.push(n[p])):(m.push(p),i.hasOwnProperty("startOffset")||(i.startOffset=p),i.endOffset=p,e.attr&&e.attr.id&&(i.groupId=e.attr.id));for(2===m.length&&(i.endOffset-=1);p=m.length;)p=m[p-1],n.splice(p,1),m.length--,a.operand.splice(p,1)}if(o=d(e.name),!o)throw new Error("operator type error: not found "+e.name);j=function(){},j.prototype=o.prototype,l=new j,o.apply(l,n),f.func=l;for(var r in e.callFn)e.callFn.hasOwnProperty(r)&&l[r]&&l[r].apply(l,e.callFn[r]);return e.attr&&(e.attr.id&&(g[e.attr.id]={objGroup:l,strGroup:a}),e.attr["data-root"]&&(g.root={objGroup:l,strGroup:a}),l.setAttr(e.attr)),l}function c(a,b){switch(a){case"empty":return new kf.EmptyExpression;case"text":return new kf.TextExpression(b)}}function d(a){return g[a]||kf[a.replace(/^[a-z]/i,function(a){return a.toUpperCase()}).replace(/-([a-z])/gi,function(a,b){return b.toUpperCase()})+"Expression"]}function e(a){var b={};if("[object Array]"==={}.toString.call(a)){b=[];for(var c=0,d=a.length;d>c;c++)b[c]=f(a[c])}else for(var e in a)a.hasOwnProperty(e)&&(b[e]=f(a[e]));return b}function f(a){return a?"object"!=typeof a?a:e(a):a}var g={},h="\uf155";return a.prototype.generateBy=function(a){var c=a.tree,d={},f={},g={};if("string"==typeof c)throw new Error("Unhandled error");return this.formula.appendExpression(b(c,e(c),d,g,f)),{select:f,parsedTree:c,tree:d,mapping:g}},a.prototype.regenerateBy=function(a){return this.formula.clearExpressions(),this.generateBy(a)},a}},b[1]={value:function(){return{toRPNExpression:b.r(2),generateTree:b.r(3)}}},b[2]={value:function(){function a(b){var e=[],f=null;for(b=c(b);f=b.shift();)"combination"===f.name&&1===f.operand.length&&"brackets"===f.operand[0].name&&(f=f.operand[0]),e.push(d.isArray(f)?a(f):f);return e}function c(a){for(var b=[],c=null;void 0!==(c=a.pop());)if(!c||"object"!=typeof c||c.sign!==!1&&"function"!==c.name)b.push(c);else{var d=c.handler(c,[],b.reverse());b.unshift(d),b.reverse()}return b.reverse()}var d=b.r(4);return a}},b[3]={value:function(){function a(b){for(var e=null,f=[],g=0,h=b.length;h>g;g++)d.isArray(b[g])&&(b[g]=a(b[g]));for(;e=b.shift();)f.push("object"==typeof e&&e.handler?e.handler(e,f,b):e);return c(f)}var c=b.r(15),d=b.r(4);return a}},b[4]={value:function(){var a=b.r(7),c=b.r(6),d=b.r(18),e={getLatexType:function(b){return b=b.replace(/^\\/,""),a[b]?"operator":c[b]?"function":"text"},isArray:function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},getDefine:function(b){return e.extend({},a[b.replace("\\","")])},getFuncDefine:function(a){return{name:"function",params:a.replace(/^\\/,""),handler:d}},getCasesDefine:function(b){return e.extend({params:b},a.cases)},getMatrixDefine:function(b,c,d){return e.extend({colCount:b,rowCount:c},a[d])},getSplitDefine:function(b){return e.extend({params:b},a.split)},getBracketsDefine:function(b,c){return e.extend({params:[b,c]},a.brackets)},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};return e}},b[5]={value:function(){var a=!0;return{".":a,"{":a,"}":a,"[":a,"]":a,"(":a,")":a,"|":a,".":a,"\\langle":a,"\\rangle":a,"\\lfloor":a,"\\rfloor":a,"\\lceil":a,"\\rceil":a}}},b[6]={value:function(){return{sin:1,cos:1,arccos:1,cosh:1,det:1,inf:1,limsup:1,Pr:1,tan:1,arcsin:1,cot:1,dim:1,ker:1,ln:1,sec:1,tanh:1,arctan:1,coth:1,exp:1,lg:1,log:1,arg:1,csc:1,gcd:1,lim:1,max:1,sinh:1,deg:1,hom:1,liminf:1,min:1,sup:1}}},b[7]={value:function(){var a=b.r(32),c=b.r(11);return{"^":{name:"superscript",type:c.OP,handler:a},_:{name:"subscript",type:c.OP,handler:a},frac:{name:"fraction",type:c.FN,sign:!1,handler:b.r(17)},dfrac:{name:"fraction",type:c.FN,sign:!1,handler:b.r(16)},sqrt:{name:"radical",type:c.FN,sign:!1,handler:b.r(34)},sum:{name:"summation",type:c.FN,traversal:"rtl",handler:b.r(35)},"int":{name:"integration",type:c.FN,traversal:"rtl",handler:b.r(20)},brackets:{name:"brackets",type:c.FN,handler:b.r(13)},cases:{name:"cases",type:c.FN,handler:b.r(14)},split:{name:"split",type:c.FN,handler:b.r(33)},mathcal:{name:"mathcal",type:c.FN,sign:!1,handler:b.r(24)},overparen:{name:"overparen",type:c.FN,sign:!1,handler:b.r(29)},underbrace:{name:"underbrace",type:c.FN,handler:b.r(37)},mathfrak:{name:"mathfrak",type:c.FN,sign:!1,handler:b.r(25)},mathbf:{name:"mathbf",type:c.FN,sign:!1,handler:b.r(23)},mathbb:{name:"mathbb",type:c.FN,sign:!1,handler:b.r(22)},mathrm:{name:"mathrm",type:c.FN,sign:!1,handler:b.r(26)},hat:{name:"hat",type:c.FN,sign:!1,handler:b.r(19)},vec:{name:"vec",type:c.FN,sign:!1,handler:b.r(19)},overrightarrow:{name:"overrightarrow",type:c.FN,sign:!1,handler:b.r(19)},widehat:{name:"widehat",type:c.FN,sign:!1,handler:b.r(19)},vmatrix:{name:"vmatrix",type:c.FN,sign:!1,handler:b.r(27)},pmatrix:{name:"pmatrix",type:c.FN,sign:!1,handler:b.r(27)},textcircled:{name:"textcircled",type:c.FN,sign:!1,handler:b.r(36)},prod:{name:"product",type:c.FN,sign:!1,handler:b.r(31)},pmod:{name:"pmod",type:c.FN,sign:!1,handler:b.r(30)},overline:{name:"overline",type:c.FN,sign:!1,handler:b.r(28)}}}},b[8]={value:function(){return{"int":b.r(40),quot:b.r(41)}}},b[9]={value:function(){return{combination:b.r(44),fraction:b.r(45),dfraction:b.r(45),"function":b.r(46),integration:b.r(48),subscript:b.r(62),superscript:b.r(64),script:b.r(59),radical:b.r(61),summation:b.r(63),product:b.r(58),brackets:b.r(42),mathcal:b.r(51),mathfrak:b.r(52),mathbb:b.r(49),mathrm:b.r(53),mathbf:b.r(50),cases:b.r(43),split:b.r(60),textcircled:b.r(65),hat:b.r(47),pmod:b.r(57),overline:b.r(55),underbrace:b.r(66),overparen:b.r(56),matrix:b.r(54)}}},b[10]={value:function(){return{"#":1,$:1,"%":1,_:1,"&":1,"{":1,"}":1,"^":1,"~":1}}},b[11]={value:function(){return{OP:1,FN:2}}},b[12]={value:function(){return function(a,b,c){a.colCount,a.rowCount;a.operand=[];for(var d=0,e=a.colCount*a.rowCount;e>d;d++)a.operand[d]=c.shift();return a.callFn={setColNum:[a.colCount]},delete a.handler,delete a.colCount,delete a.rowCount,a}}},b[13]={value:function(){var a=b.r(5);return function(b,c,d){for(var e=0,f=b.params.length;f>e;e++){if(!(b.params[e]in a))throw new Error("Brackets: invalid params");b.params[e].length>1&&(b.params[e]+="\\")}return b.operand=b.params,b.params[2]=d.shift(),delete b.handler,delete b.params,b}}},b[14]={value:function(){return function(a,b,c){var d=a.params;a.operand=[];for(var e=0;d>e;e++)a.operand.push(c.shift());return delete a.handler,delete a.params,a}}},b[15]={value:function(){return function(){return{name:"combination",operand:arguments[0]||[]}}}},b[16]={value:function(){return function(a,b,c){var d=c.shift(),e=c.shift();if(void 0===d||void 0===e)throw new Error("Frac: Syntax Error");return d.handler&&"integration"===d.name?(d=d.handler(d,b,[e]),e=c.shift()):e.handler&&"integration"===e.name&&(e=e.handler(e,b,[c.shift()])),a.operand=[d,e],a.callFn={setZoom:[1]},delete a.handler,a}}},b[17]={value:function(){return function(a,b,c){var d=c.shift(),e=c.shift();if(void 0===d||void 0===e)throw new Error("Frac: Syntax Error");return d.handler&&"integration"===d.name?(d=d.handler(d,b,[e]),e=c.shift()):e.handler&&"integration"===e.name&&(e=e.handler(e,b,[c.shift()])),a.operand=[d,e],delete a.handler,a}}},b[18]={value:function(){var a=b.r(21);return function(b,c,d){var e=a.exec(d);return e.expr&&e.expr.handler&&"integration"===e.expr.name&&(e.expr=e.expr.handler(e.expr,c,[d.shift()])),b.operand=[b.params,e.expr,e.superscript,e.subscript],delete b.params,delete b.handler,b}}},b[19]={value:function(){return function(a,b,c){var d=c.shift(),e=a.name;return a.name="hat",a.operand=[d],a.callFn={setType:[e]},delete a.handler,a}}},b[20]={value:function(){var a=b.r(21),c=b.r(11).FN;return function(b,d,e){var f=e.shift(),g=a.exec(e);return g.expr&&g.expr.type===c&&g.expr.handler&&"integration"===g.expr.name&&(g.expr=g.expr.handler(g.expr,d,[e.shift()])),b.operand=[g.expr,g.superscript,g.subscript],b.callFn={setType:[0|f]},delete b.handler,b}}},b[21]={value:function(){function a(a){var c=b(a),d=null,e={superscript:null,subscript:null};if(!c)return e;if(d=b(a),e[c.type]=c.value||null,d){if(d.type===c.type)throw new Error("Script: syntax error!");e[d.type]=d.value||null}return e}function b(a){var b=a.shift();return b?"subscript"===b.name||"superscript"===b.name?{type:b.name,value:a.shift()}:(a.unshift(b),null):null}return{exec:function(b){var c=a(b),d=b.shift();if(d&&d.name&&-1!==d.name.indexOf("script"))throw new Error("Script: syntax error!");return c.expr=d||null,c}}}},b[22]={value:function(){return function(a,b,c){var d=c.shift();return"object"==typeof d&&"combination"===d.name&&(d=d.operand.join("")),a.name="text",a.attr={_reverse:"mathbb"},a.callFn={setFamily:["KF AMS BB"]},a.operand=[d],delete a.handler,a}}},b[23]={value:function(){return function(a,b,c){var d=c.shift();return"object"==typeof d&&"combination"===d.name&&(d=d.operand.join("")),a.name="text",a.attr={_reverse:"mathbf"},a.callFn={setFamily:["KF AMS BOLD"]},a.operand=[d],delete a.handler,a}}},b[24]={value:function(){return function(a,b,c){var d=c.shift();return"object"==typeof d&&"combination"===d.name&&(d=d.operand.join("")),a.name="text",a.attr={_reverse:"mathcal"},a.callFn={setFamily:["KF AMS CAL"]},a.operand=[d],delete a.handler,a}}},b[25]={value:function(){return function(a,b,c){var d=c.shift();return"object"==typeof d&&"combination"===d.name&&(d=d.operand.join("")),a.name="text",a.attr={_reverse:"mathfrak"},a.callFn={setFamily:["KF AMS FRAK"]},a.operand=[d],delete a.handler,a}}},b[26]={value:function(){return function(a,b,c){var d=c.shift();return"object"==typeof d&&"combination"===d.name&&(d=d.operand.join("")),a.name="text",a.attr={_reverse:"mathrm"},a.callFn={setFamily:["KF AMS ROMAN"]},a.operand=[d],delete a.handler,a}}},b[27]={value:function(){return function(a,b,c){var d=(a.colCount,a.rowCount,a.name.charAt(0));a.operand=[];for(var e=0,f=a.colCount*a.rowCount;f>e;e++)a.operand[e]=c.shift();return a.callFn={setColNum:[a.colCount],setType:[d]},a.name="matrix",delete a.handler,delete a.colCount,delete a.rowCount,a}}},b[28]={value:function(){return function(a,b,c){var d=c.shift();return a.operand=[d],delete a.handler,a}}},b[29]={value:function(){return function(a,b,c){var d=c.shift();return a.operand=[d],delete a.handler,a}}},b[30]={value:function(){return function(a,b,c){var d=c.shift();return a.operand=[d],delete a.handler,a}}},b[31]={value:function(){var a=b.r(21),c=b.r(11).FN;return function(b,d,e){var f=a.exec(e);return f.expr&&f.expr.type===c&&f.expr.handler&&"integration"===f.expr.name&&(f.expr=f.expr.handler(f.expr,d,[e.shift()])),b.operand=[f.expr,f.superscript,f.subscript],delete b.handler,b}}},b[32]={value:function(){return function(a,b,c){var d=b.pop(),e=c.shift()||null;if(!e)throw new Error("Missing script");if(d=d||"",d.name===a.name||"script"===d.name)throw new Error("script error");return"subscript"===d.name?(d.name="script",d.operand[2]=d.operand[1],d.operand[1]=e,d):"superscript"===d.name?(d.name="script",d.operand[2]=e,d):(a.operand=[d,e],delete a.handler,a)}}},b[33]={value:function(){return function(a,b,c){var d=a.params;a.operand=[];for(var e=0;d>e;e++)a.operand.push(c.shift());return delete a.handler,delete a.params,a}}},b[34]={value:function(){var a=b.r(15);return function(b,c,d){var e=d.shift(),f=null,g=null;if("["===e){for(e=[];(f=d.shift())&&"]"!==f;)e.push(f);e=0===e.length?null:a(e),g=d.shift()}else g=e,e=null;return b.operand=[g,e],delete b.handler,b}}},b[35]={value:function(){var a=b.r(21),c=b.r(11).FN;return function(b,d,e){var f=a.exec(e);return f.expr&&f.expr.type===c&&f.expr.handler&&"integration"===f.expr.name&&(f.expr=f.expr.handler(f.expr,d,[e.shift()])),b.operand=[f.expr,f.superscript,f.subscript],delete b.handler,b}}},b[36]={value:function(){return function(a,b,c){var d=c.shift();return"object"==typeof d&&"combination"===d.name&&(d=d.operand.join("")),a.operand=[d],delete a.handler,a}}},b[37]={value:function(){return function(a,b,c){return a.operand=[c.shift(),c.shift()],delete a.handler,a}}},b[38]={value:function(){function a(a){if(d(a))return a.substring(1);switch(m.getLatexType(a)){case"operator":return m.getDefine(a);case"function":return m.getFuncDefine(a);default:return/\\\s*$/.test(a)?"":c(a)}}function c(a){return 0===a.indexOf("\\")?a+"\\":a}function d(a){return 0===a.indexOf("\\")?!!l[a.substring(1)]:!1}function e(a){return a.replace(/\s*([^a-z0-9\s])\s*/gi,function(a,b){return b})}var f=b.r(68).Parser,g=b.r(1),h=b.r(8),i=b.r(67),j=b.r(7),k=b.r(9),l=b.r(10),m=b.r(4),n="\ufff8",o="\ufffc",p="",q=new RegExp(n+"|"+o,"g"),r=new RegExp(n,"g"),s=new RegExp(o,"g");f.register("latex",f.implement({parse:function(a){var b=this.split(this.format(a));return b=this.parseToGroup(b),b=this.parseToStruct(b),this.generateTree(b)},serialization:function(a,b){return i(a,b)},expand:function(a){var b=a.parse,c=null,d=a.pre,e=a.reverse;for(var f in b)b.hasOwnProperty(f)&&(c=f.replace(/\\/g,""),j[c]=b[f]);for(var f in e)e.hasOwnProperty(f)&&(k[f.replace(/\\/g,"")]=e[f]);if(d)for(var f in d)d.hasOwnProperty(f)&&(h[f.replace(/\\/g,"")]=d[f])},format:function(a){var b=new RegExp(p,"g");a=e(a),a=a.replace(b,"").replace(/\\\\/g,p),a=a.replace(q,"").replace(/\\{/gi,n).replace(/\\}/gi,o);for(var c in h)h.hasOwnProperty(c)&&(a=h[c](a));return a.replace(b,"\\\\")},split:function(a){var b=[],c=/(?:\\[^a-z]\s*)|(?:\\[a-z]+\s*)|(?:[{}]\s*)|(?:[^\\{}]\s*)/gi,d=/^\s+|\s+$/g,e=null;for(a=a.replace(d,"");e=c.exec(a);)e=e[0].replace(d,""),e&&b.push(e);return b},generateTree:function(a){for(var b=[],c=null;c=a.shift();)b.push(m.isArray(c)?this.generateTree(c):c);return b=g.toRPNExpression(b),g.generateTree(b)},parseToGroup:function(a){for(var b=[],c=[b],d=0,e=0,f=0,g=[],h=0,i=a.length;i>h;h++)switch(a[h]){case"{":d++,c.push(b),b.push([]),b=b[b.length-1];break;case"}":d--,b=c.pop();break;case"\\left":e++,c.push(b),b.push([[]]),b=b[b.length-1][0],b.type="brackets",h++,b.leftBrackets=a[h].replace(r,"{").replace(s,"}");break;case"\\right":e--,h++,b.rightBrackets=a[h].replace(r,"{").replace(s,"}"),b=c.pop();break;case"\\begin":for(f++,c.push(b),b.push([[]]),b=b[b.length-1][0],b.type="begin",h+=2,g=[];a[h]&&"}"!==a[h];)g.push(a[h]),h++;b.beginType=g.join("");break;case"\\end":for(f--,h+=2,g=[];a[h]&&"}"!==a[h];)g.push(a[h]),h++;if(b.beginType!==g.join(""))throw new Error("\\begin command error");b=c.pop();break;default:b.push(a[h].replace(r,"\\{").replace(s,"\\}"))}if(0!==d)throw new Error("Group Error!");if(0!==f)throw new Error("Cases Error!");if(0!==e)throw new Error("Brackets Error!");return c[0]},parseToStruct:function(b){for(var c=[],d=null,e=[],f=0,g=null,h=null,i=0,j=b.length;j>i;i++)if(null!==b[i])if(m.isArray(b[i]))if("brackets"===b[i].type)c.push(m.getBracketsDefine(b[i].leftBrackets,b[i].rightBrackets)),c.push(this.parseToStruct(b[i]));else if("begin"===b[i].type&&"cases"===b[i].beginType){for(d=[],f=0,g=[],h=b[i],i++;h[f];)"\\\\"===h[f]?(g.push(d),d=[]):d.push(h[f]),f++;g.push(d),c.push(m.getCasesDefine(g.length));for(var i=0,j=g.length;j>i;i++)c.push(this.parseToStruct(g[i]))}else if("begin"!==b[i].type||"vmatrix"!==b[i].beginType&&"pmatrix"!==b[i].beginType)if("begin"===b[i].type&&"split"===b[i].beginType){var k=b[i].beginType;d=[],f=0,g=[],h=b[i],e=[];var l=0;for(i++;h[f];)"\\\\"===h[f]?(f++,d[l]=this.parseToStruct(e),l++,e=[]):"&"===h[f]?(d[l]=this.parseToStruct(e),l++,e=[]):e.push(h[f]),f++;d[l]=this.parseToStruct(e),g=d,c.push(m.getSplitDefine(g.length));for(var i=0,j=g.length;j>i;i++)c.push(g[i])}else c.push(this.parseToStruct(b[i]));else{var k=b[i].beginType;d=[],f=0,g=[],h=b[i],e=[];var l=0;for(i++;h[f];)"\\\\"===h[f]?(d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),l=0,e=[]):"&"===h[f]?(d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),l++,e=[]):e.push(h[f]),f++;d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),g=d,c.push(m.getMatrixDefine(g.length,g[0].length,k));for(var i=0,j=g[0].length;j>i;i++)for(var f=0,n=g.length;n>f;f++)c.push(g[f][i])}else"\\underbrace"===b[i]?(c.push(a(b[i])),b[i+2]=null):(d=a(b[i]),d&&c.push(d));return c}}))}},b[39]={value:function(){function a(a){if(d(a))return a.substring(1);switch(m.getLatexType(a)){case"operator":return m.getDefine(a);case"function":return m.getFuncDefine(a);default:return/\\\s*$/.test(a)?"":c(a)}}function c(a){return 0===a.indexOf("\\")?a+"\\":a}function d(a){return 0===a.indexOf("\\")?!!l[a.substring(1)]:!1}function e(a){return a.replace(/\s*([^a-z0-9\s])\s*/gi,function(a,b){return b})}var f=b.r(68).Parser,g=b.r(1),h=b.r(8),i=b.r(67),j=b.r(7),k=b.r(9),l=b.r(10),m=b.r(4),n="\ufff8",o="\ufffc",p="",q=new RegExp(n+"|"+o,"g"),r=new RegExp(n,"g"),s=new RegExp(o,"g");f.register("latex",f.implement({parse:function(a){var b=this.split(this.format(a));return b=this.parseToGroup(b),b=this.parseToStruct(b),this.generateTree(b)},serialization:function(a,b){return i(a,b)},expand:function(a){var b=a.parse,c=null,d=a.pre,e=a.reverse;for(var f in b)b.hasOwnProperty(f)&&(c=f.replace(/\\/g,""),j[c]=b[f]);for(var f in e)e.hasOwnProperty(f)&&(k[f.replace(/\\/g,"")]=e[f]);if(d)for(var f in d)d.hasOwnProperty(f)&&(h[f.replace(/\\/g,"")]=d[f])},format:function(a){var b=new RegExp(p,"g");a=e(a),a=a.replace(b,"").replace(/\\\\/g,p),a=a.replace(q,"").replace(/\\{/gi,n).replace(/\\}/gi,o);for(var c in h)h.hasOwnProperty(c)&&(a=h[c](a));return a.replace(b,"\\\\")},split:function(a){var b=[],c=/(?:\\[^a-z]\s*)|(?:\\[a-z]+\s*)|(?:[{}]\s*)|(?:[^\\{}]\s*)/gi,d=/^\s+|\s+$/g,e=null;for(a=a.replace(d,"");e=c.exec(a);)e=e[0].replace(d,""),e&&b.push(e);return b},generateTree:function(a){for(var b=[],c=null;c=a.shift();)b.push(m.isArray(c)?this.generateTree(c):c);return b=g.toRPNExpression(b),g.generateTree(b)},parseToGroup:function(a){for(var b=[],c=[b],d=0,e=0,f=0,g=[],h=0,i=a.length;i>h;h++)switch(a[h]){case"{":d++,c.push(b),b.push([]),b=b[b.length-1];break;case"}":d--,b=c.pop();break;case"\\left":e++,c.push(b),b.push([[]]),b=b[b.length-1][0],b.type="brackets",h++,b.leftBrackets=a[h].replace(r,"{").replace(s,"}");break;case"\\right":e--,h++,b.rightBrackets=a[h].replace(r,"{").replace(s,"}"),b=c.pop();break;case"\\begin":for(f++,c.push(b),b.push([[]]),b=b[b.length-1][0],b.type="begin",h+=2,g=[];a[h]&&"}"!==a[h];)g.push(a[h]),h++;b.beginType=g.join("");break;case"\\end":for(f--,h+=2,g=[];a[h]&&"}"!==a[h];)g.push(a[h]),h++;if(b.beginType!==g.join(""))throw new Error("\\begin command error");b=c.pop();break;default:b.push(a[h].replace(r,"\\{").replace(s,"\\}"))}if(0!==d)throw new Error("Group Error!");if(0!==f)throw new Error("Cases Error!");if(0!==e)throw new Error("Brackets Error!");return c[0]},parseToStruct:function(b){for(var c=[],d=null,e=[],f=0,g=null,h=null,i=0,j=b.length;j>i;i++)if(null!==b[i])if(m.isArray(b[i]))if("brackets"===b[i].type)c.push(m.getBracketsDefine(b[i].leftBrackets,b[i].rightBrackets)),c.push(this.parseToStruct(b[i]));else if("begin"===b[i].type&&"cases"===b[i].beginType){for(d=[],f=0,g=[],h=b[i],i++;h[f];)"\\\\"===h[f]?(g.push(d),d=[]):d.push(h[f]),f++;g.push(d),c.push(m.getCasesDefine(g.length));for(var i=0,j=g.length;j>i;i++)c.push(this.parseToStruct(g[i]))}else if("begin"!==b[i].type||"vmatrix"!==b[i].beginType&&"pmatrix"!==b[i].beginType)if("begin"===b[i].type&&"array"===b[i].beginType){var k=b[i].beginType;d=[],f=1,g=[],h=b[i],e=[];var l=0,n=h[0];for(i++;h[f];)"\\\\"===h[f]?(d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),l=0,e=[]):"&"===h[f]?(d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),l++,e=[]):e.push(h[f]),f++;d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),g=d,c.push(m.getArrayDefine(g.length,g[0].length,n,k));for(var i=0,j=g[0].length;j>i;i++)for(var f=0,o=g.length;o>f;f++)c.push(g[f][i])}else if("begin"===b[i].type&&"split"===b[i].beginType){var k=b[i].beginType;d=[],f=0,g=[],h=b[i],e=[];var l=0;for(i++;h[f];)"\\\\"===h[f]?(f++,d[l]=this.parseToStruct(e),l++,e=[]):"&"===h[f]?(d[l]=this.parseToStruct(e),l++,e=[]):e.push(h[f]),f++;d[l]=this.parseToStruct(e),g=d,c.push(m.getSplitDefine(g.length));for(var i=0,j=g.length;j>i;i++)c.push(g[i])}else c.push(this.parseToStruct(b[i]));else{var k=b[i].beginType;d=[],f=0,g=[],h=b[i],e=[];var l=0;for(i++;h[f];)"\\\\"===h[f]?(d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),l=0,e=[]):"&"===h[f]?(d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),l++,e=[]):e.push(h[f]),f++;d[l]||(d[l]=[]),d[l].push(this.parseToStruct(e)),g=d,c.push(m.getMatrixDefine(g.length,g[0].length,k));for(var i=0,j=g[0].length;j>i;i++)for(var f=0,o=g.length;o>f;f++)c.push(g[f][i])}else"\\underbrace"===b[i]?(c.push(a(b[i])),b[i+2]=null):(d=a(b[i]),d&&c.push(d));return c}}))}},b[40]={value:function(){return function(a){return a.replace(/\\(i+)nt(\b|[^a-zA-Z])/g,function(a,b,c){return"\\int "+b.length+c})}}},b[41]={value:function(){return function(a){return a.replace(/``/g,"\u201c")}}},b[42]={value:function(){return function(a){return("{"===a[0]||"}"===a[0])&&(a[0]="\\"+a[0]),("{"===a[1]||"}"===a[1])&&(a[1]="\\"+a[1]),["\\left",a[0],a[2],"\\right",a[1]].join(" ")}}},b[43]={value:function(){return function(a){for(var b=[],c=0,d=a.length;d>c;c++)"\uf155"===a[c]?b[b.length-1]+=a[c]:b.push(a[c]);return["\\begin{cases}",b.join(" \\\\ "),"\\end{cases}"].join(" ")}}},b[44]={value:function(){return function(a){return this.attr["data-root"]||this.attr["data-placeholder"]?a.join(""):"{"+a.join("")+"}"}}},b[45]={value:function(){return function(a){return this.callFn?"\\dfrac "+a[0]+" "+a[1]:"\\frac "+a[0]+" "+a[1]}}},b[46]={value:function(){return function(a){var b=["\\"+a[0]];return a[2]&&b.push("^"+a[2]),a[3]&&b.push("_"+a[3]),a[1]&&b.push(" "+a[1]),b.join("")}}},b[47]={value:function(){return function(a){var b=this.callFn.setType[0];return"\\"+b+a[0]}}},b[48]={value:function(){return function(a){var b=["\\int "];if(this.callFn&&this.callFn.setType){b=["\\"];for(var c=0,d=this.callFn.setType;d>c;c++)b.push("i");b.push("nt ")}return a[1]&&b.push("^"+a[1]),a[2]&&b.push("_"+a[2]),a[0]&&b.push(" "+a[0]),b.join("")}}},b[49]={value:function(){return function(a){return"\\mathbb{"+a[0]+"}"}}},b[50]={value:function(){return function(a){return"\\mathbf{"+a[0]+"}"}}},b[51]={value:function(){return function(a){return"\\mathcal{"+a[0]+"}"}}},b[52]={value:function(){return function(a){return"\\mathfrak{"+a[0]+"}"}}},b[53]={value:function(){return function(a){return"\\mathrm{"+a[0]+"}"}}},b[54]={value:function(){return function(a){for(var b=this.callFn.setColNum[0],c=a.length/b,d=this.callFn.setType[0],e=[],f=0;c>f;f++)e[f]=a.slice(f*b,(f+1)*b).join("&");return["\\begin{"+d+"matrix}",e.join(" \\\\ "),"\\end{"+d+"matrix}"].join(" ")}}},b[55]={value:function(){return function(a){return a=a[0],"{"===a[0]?"\\overline"+a:"\\overline{"+a+"}"}}},b[56]={value:function(){return function(a){return"\\overparen "+a[0]}}},b[57]={value:function(){return function(a){return a=a[0],"{"===a[0]?"\\pmod"+a:"\\pmod{"+a+"}"}}},b[58]={value:function(){return function(a){var b=["\\prod "];return a[1]&&b.push("^"+a[1]),a[2]&&b.push("_"+a[2]),a[0]&&b.push(" "+a[0]),b.join("")}}},b[59]={value:function(){return function(a){return a[0]+"^"+a[1]+"_"+a[2]}}},b[60]={value:function(){return function(a){for(var b=a[0],c=[],d=1;d<a.length;d++)c.push("&"+a[d]);return["\\begin{split}",b,c.join(" \\\\ "),"\\end{split}"].join(" ")}}},b[61]={value:function(){return function(a){var b=["\\sqrt"];return a[1]&&b.push("["+a[1]+"]"),b.push(" "+a[0]),b.join("")}}},b[62]={value:function(){return function(a){return a[0]+"_"+a[1]}}},b[63]={value:function(){return function(a){var b=["\\sum "];return a[1]&&b.push("^"+a[1]),a[2]&&b.push("_"+a[2]),a[0]&&b.push(" "+a[0]),b.join("")}}},b[64]={value:function(){return function(a){return a[0]+"^"+a[1]}}},b[65]={value:function(){return function(a){return"\\textcircled{"+a[0]+"}"}}},b[66]={value:function(){return function(a){return["\\underbrace",a[0]+"_"+a[1]].join(" ")}}},b[67]={value:function(){function a(b,e){var g=[],h=null,i=null;if("object"!=typeof b)return c(b)?"\\"+b+" ":b.replace(f,function(a,b){return b+" "});"combination"===b.name&&1===b.operand.length&&"combination"===b.operand[0].name&&(b=b.operand[0]),i=b.operand;for(var j=0,k=i.length;k>j;j++)g.push(i[j]?a(i[j]):i[j]);return h=b.attr&&b.attr._reverse?b.attr._reverse:b.name,d[h].call(b,g,e)}function c(a){return!!e[a]}var d=b.r(9),e=b.r(10),f=/(\\(?:[\w]+)|(?:[^a-z]))\\/gi;return function(b,c){return a(b,c)}}},b[68]={value:function(a,b,c){function d(a){this.impl=new a,this.conf={}}function e(){this.conf={}}var f={},g={},h={extend:function(a,b){var c=null;b=[].slice.call(arguments,1);for(var d=0,e=b.length;e>d;d++){c=b[d];for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f])}},setData:function(a,b,c){if("string"==typeof b)a[b]=c;else{if("object"!=typeof b)throw new Error("invalid option");for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}}},i={use:function(a){if(!g[a])throw new Error("unknown parser type");return this.proxy(g[a])},config:function(a,b){return h.setData(f,a,b),this},register:function(a,b){return g[a.toLowerCase()]=b,this},implement:function(a){var b=function(){},c=a.constructor||function(){},d=function(){e.call(this),c.call(this)};b.prototype=e.prototype,d.prototype=new b,delete a.constructor;for(var f in a)"constructor"!==f&&a.hasOwnProperty(f)&&(d.prototype[f]=a[f]);return d},proxy:function(a){return new d(a)}};h.extend(d.prototype,{config:function(a,b){h.setData(this.conf,a,b)},set:function(a,b){this.impl.set(a,b)},parse:function(a){var b={config:{},tree:this.impl.parse(a)};return h.extend(b.config,f,this.conf),b},serialization:function(a,b){return this.impl.serialization(a,b)},expand:function(a){this.impl.expand(a)}}),h.extend(e.prototype,{set:function(a,b){h.extend(this.conf,a,b)},parse:function(){throw new Error("Abstract function")}}),c.exports={Parser:i,ParserInterface:e}}},b[69]={value:function(){var a=b.r(68).Parser;b.r(38),window.kf.Parser=a,window.kf.Assembly=b.r(0)}};var c={"kf.start":69};!function(){try{a("kf.start")}catch(b){}}(this)}();